---
title: git分支
date: 2019-04-07 19:25:05
tags: git
categories: git
---

# 分支简介

在前面已经介绍过了，git中保存的是一系列不同时刻的文件快照，而不是文件的变化或差异。

在进行提交操作的时候，git会保存一个提交对象（commit object）。从这里可以看出，每次提交的提交对象包含一个指向暂存内容快照的指针。在每一次`git commit`的提交操作时，git会计算项目路径下的子目录的校验和，然后在git仓库中将这个校验和保存为树对象，随后，git会创建一个提交对象，除了上述信息外，还包含指向这个树对象的指针。这样一来，git就会在需要的时候重现此次保存的快照。

git的分支，其实本质上仅仅是指向提交对象的可变指针。默认情况下，git的分支名字是`master`，所有的提交都是在`master`分支上进行的操作。

## 分支创建

使用`git branch`命令就可以创建一个分支，也就是创建了一个可以移动的新的指针。如：

```bash
git branch newbranch
```

这会在当前所在的提交对象上创建一个指针。git使用一个特殊的指针`HEAD`跟踪不同的分支，需要注意的是，不同与别的版本控制系统，`HEAD`在git中只是指向当前所在的本地分支的一个指针。

在创建一个新的分支后，当前的`HEAD`并不会切换到新的分支上。

## 分支切换

上面我们创建了一个新的分支`newbranch`，但是我们的`HEAD`并没有切换到新的分支上，要切换到新的分支，我们需要使用`git checkout`命令。如：

```bash
git checkout newbranch
```

这样`HEAD`就指向了`newbranch`分支，切换分支时目标分支必须存在，否则会显示找不到目标分支的错误。![newbranch](https://i.loli.net/2019/04/07/5ca9ffae24ae0.png)

过程如上图所示，这样做的好处在于，如果我们进行下一次提交的时候，`newbranch`分支会继续向前移动，而`master`分支则不变，仍然处于`C3`这个位置，如下：![commit](https://i.loli.net/2019/04/07/5caa010fb65af.png)

这时候，可以切换回`master`分支：

```bash
git checkout master
```

结果如下所示：![chenkback](https://i.loli.net/2019/04/07/5caa0846221a6.png)

可以看出，这条命令做了两件事：1、使HEAD指回master分支；2、将工作目录恢复成master分支所指向的快照内容。这时候，如果我们提交更改，就会使得开发方向向另外的方向发展。 

如下所示： ![twobranch](https://i.loli.net/2019/04/07/5caa097f62270.png)

上述过程阐述了在不同分支之间切换和工作的过程，所用到的命令包括`branch（增加分支）`、`checkout（切换分支）`及`commit（提交）`。当然，这些分支在适当的时机可以进行合并，后续会有相关说明。

我们可以使用`git log`命令完整的查看分支历史，运行`git log --oneline --decorate --graph --all`，将会输出提交历史、各个分支的指向及项目的分支情况。

# 分支的新建与合并

上一部分的内容中，我们简单的了解了分支的创建与切换等功能，这一部分我们从一个例子入手，整体的回顾一下git分支的工作流。

假设我们在开发一个大型项目，针对不同的客户有不同的定制化需求，目前我们的`master`分支主要开发一些通用功能。现在，你接到了一个新的任务，为客户A定制化开发一个新功能。

## 新建分支

为了应对定制化功能的开发，首先我们需要新建一个分支，并且切换到新分支上进行开发工作，可以使用如下命令操作：

```bash
git checkout -b newFunction
```



